## suggested content for conf file for nginx.
## proxy_pass uses either the host name or 172.31.132.183.

#server {
#	listen 3000;
#	server_name  sapshah@sapshah-cs-bld.insieme.local;

#	location / {
#		proxy_pass "http://172.31.132.183:443";	
		
#		 proxy_buffering off;
		 
#		 proxy_set_header   Host $http_host;
#  		 proxy_set_header X-Real-IP $remote_addr;
 		 
#		 proxy_set_header X-Forwarded-Host $host;
# 		 proxy_set_header X-Forwarded-Port $server_port;
#	 }
#}

#server {
#	listen 9000;
#	listen localhost:6666;
#	server_name  sapshah@sapshah-cs-bld.insieme.local;


#	location / {
#		try_files $uri $uri/ =404;
#}

#	location / {
#		proxy_pass "http://172.31.132.183:443";

#		 proxy_buffering off;
		 
#		 proxy_set_header   Host $http_host;
#  		 proxy_set_header X-Real-IP $remote_addr;
 		 
#		 proxy_set_header X-Forwarded-Host $host;
# 		 proxy_set_header X-Forwarded-Port $server_port;
#	 }
#}


#server {
	# From
#listen 3000;
#server_name  localhost;

# To
#listen 3333;
#server_name  localhost test.x;
#}

### working solution for fe.
#server { 
#        listen 8080; 
#        listen localhost:3333; 
#       # server_name  sapshah@sapshah-cs-bld.insieme.local; 
# 
# 
#                location / { 
#                proxy_pass "http://127.0.0.1:3000"; 
# 
#                 proxy_buffering off; 
#                  
#                 proxy_set_header   Host $http_host; 
#                 proxy_set_header X-Real-IP $remote_addr; 
#                  
#                 proxy_set_header X-Forwarded-Host $host; 
#                 proxy_set_header X-Forwarded-Port $server_port; 
#         } 
#} 

#server { 
#        listen 8080; 
#        listen localhost:3333; 
#        # server_name  sapshah@sapshah-cs-bld.insieme.local; 
#
# 
#                location / { 
#                proxy_pass "http://127.0.0.1:6666"; 
# 
#                 proxy_buffering off; 
#                  
#                 proxy_set_header   Host $http_host; 
#                 proxy_set_header X-Real-IP $remote_addr; 
#                  
#                 proxy_set_header X-Forwarded-Host $host; 
#                 proxy_set_header X-Forwarded-Port $server_port; 
#         } 
#} 

server {
        listen 8080;
		listen 172.31.132.183:6666;
		server_name  sapshah@sapshah-cs-bld.insieme.local;

        location / {
                proxy_pass "http://172.31.132.183:3000";
				proxy_set_header   Host $http_host;
				proxy_set_header X-Real-IP $remote_addr;
 		 		proxy_set_header X-Forwarded-Host $host;
				proxy_set_header X-Forwarded-Port $server_port;
        }
}

upstream fuel {

     # Defines a group of servers. Servers can listen on different ports. 

     server 172.31.132.183:6666 fail_timeout=0;             

}




upstream frontend {

        server 172.31.132.183:3000 fail_timeout=0;      

}




server {

            listen 172.31.132.183:80;                                             

            # domains and IP address you want to serve 

            server_name sapshah@sapshah-cs-bld.insieme.local; #SERVER_IP_ADDRESS;        

         #   access_log /path/to/log/on/server/nginx_access.log;         # set your logs 

           

            # note: uses diff logs for diff sub domains

          #  error_log /path/to/log/on/server/nginx_error.log;          




        location / {                                             

                    # requests on '/' will be proxy_pass 

                    #proxy server for sending data to node.js

                    proxy_pass.  "http://172.31.132.183:3000"; # http://frontend;                   

        }

        location /img {    

                    # remember let nginx handle static files not app code

                    root   ; #/path/to/static/files/frontend/app/;

        }

### working on this part.




        location /api {               

            # requests to the API will be proxy_pass to the backend API infra

            # read this -> http://en.wikipedia.org/wiki/X-Forwarded-For

            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 

            

            # pass the host header from the client to help with redirects 

            proxy_set_header Host $http_host;           

            

            # stops nginx from doing something silly

            proxy_redirect off;                                

            

            # proxy_pass to backend

            proxy_pass "/api/v1/";                            

            

            # send the IP address and remote server address for secuirty 

            proxy_set_header X-Real-IP $remote_addr;          

            

            # Adds headers to the HTTP response 

            add_header P3P 'CP="ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV"';  

        }

    }

server {

        # If the remote server is not listed its goes to the default_server

       listen IP:PORT default_server;          

       return 404;

}